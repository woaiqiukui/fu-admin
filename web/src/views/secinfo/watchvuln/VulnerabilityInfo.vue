<template>
  <div class="table-container">
    <a-table
      :columns="columns"
      :dataSource="vulnerabilities"
      rowKey="unique_key"
      class="vulnerability-table"
      @row-click="handleRowClick"
    />
  </div>
</template>

<script lang="tsx">
  import { defineComponent } from 'vue';
  import { Table, Tag } from 'ant-design-vue'; // Assuming you have Ant Design Vue installed
  import { Button } from '/@/components/Button';

  export default defineComponent({
    name: 'VulnerabilityInfo',
    components: {
      [Table.name]: Table,
      [Table.Column.name]: Table.Column,
      [Tag.name]: Tag,
    },
    props: {
      vulnerabilities: {
        type: Array,
        required: true,
      },
    },
    data() {
      return {
        columns: [
          {
            title: '漏洞名称',
            dataIndex: 'title',
            key: 'title',
            customRender: ({ record }) => {
              return (
                <Button
                  type="link"
                  size="small"
                  href={record.from_source}
                  title={record.title}
                  class="title-cell"
                >
                  {() => record.title}
                </Button>
              );
            },
          },
          {
            title: '描述',
            dataIndex: 'description',
            key: 'description',
            class: 'description-cell',
            customRender: ({ record }) => {
              return <span title={record.description}>{record.description}</span>;
            },
          },
          {
            title: '严重程度',
            dataIndex: 'severity',
            key: 'severity',
            slots: { customRender: 'severity' },
            class: 'severity-cell', // Apply the class here
          },
          {
            title: 'CVE',
            dataIndex: 'cve',
            key: 'cve',
            class: 'cve-cell', // Apply the class here
          },
          {
            title: '公开日期',
            dataIndex: 'disclosure',
            key: 'disclosure',
            class: 'disclosure-cell', // Apply the class here
          },
          {
            title: '解决方案',
            dataIndex: 'solutions',
            key: 'solutions',
            class: 'solutions-cell', // Apply the class here
          },
          {
            title: '标签',
            dataIndex: 'tags',
            key: 'tags',
            slots: { customRender: 'tags' },
            customRender: ({ text }) => {
              if (Array.isArray(text)) {
                return text.map((tag) => {
                  return <Tag color="blue">{tag}</Tag>;
                });
              } else {
                return null; // or handle the case when 'text' is not an array
              }
            },
            class: 'tags-cell', // Apply the class here
          },
        ],
      };
    },
    methods: {
      handleRowClick(record) {
        // Redirect to vulnerability details page with the unique_key
        const url = record.from_source; // Replace with your actual URL
        window.location.href = url;
      },
    },
  });
</script>

<style>
  .table-container {
    width: 100%;
    overflow-x: auto;
  }

  .vulnerability-table {
    width: 100%;
    margin-bottom: 20px;
  }

  .severity-cell,
  .cve-cell,
  .disclosure-cell,
  .solutions-cell,
  .tags-cell,
  .title-cell,
  .description-cell {
    max-width: 200px; /* Adjust the max-width according to your design */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .cve-cell {
    min-width: 170px;
  }
  .disclosure-cell {
    min-width: 120px; /* Adjust the max-width according to your design */
  }

  .severity-cell {
    color: darkred; /* Dark red for "严重" */
  }

  .severity-cell[title='高危'] {
    color: red; /* Red for "高危" */
  }
</style>
